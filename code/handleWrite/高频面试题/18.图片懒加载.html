<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片懒加载</title>
</head>

<body>
  <div style="height: 200vh;">
    <h1>图片懒加载</h1>
    <img src="default.png" src="https://xxxx/real.png" data-set="myRealImgSrc">
  </div>

  <script>
    function isVisible(el) {
      const position = el.getBoundingClientRect()
      const windowHeight = document.documentElement.clientHeight
      // 顶部边缘可见
      const topVisible = position.top > 0 && position.top < windowHeight;
      // 底部边缘可见
      const bottomVisible = position.bottom < windowHeight && position.bottom > 0;
      return topVisible || bottomVisible;
    }

    function imageLazyLoad() {
      console.log(66)
      const images = document.querySelectorAll('img')
      for (let img of images) {
        console.log('img的属性:', img)
        const realSrc = img['data-set']
        if (!realSrc) continue
        if (isVisible(img)) {
          img.src = realSrc
          img.dataset.src = ''
        }
      }
    }

    // 测试
    window.addEventListener('load', imageLazyLoad)
    window.addEventListener('scroll', imageLazyLoad)
    // or
    // window.addEventListener('scroll', throttle(imageLazyLoad, 1000))
  </script>
</body>

</html>